/*! Publicity 2015-06-04 */
!function(a,b,c,d,e){var f={API:{endpoint:"https://trends.revcontent.com/api/v1/?",api_key:"fdbd849fb2b8c1c259585e7bcd6a09cc87e3e5b7",pub_id:10,widget_id:21,type:"json",domain:"powr.com"}},g={ReactCSSTransitionGroup:d.addons.CSSTransitionGroup,stack:[],getStack:function(){return this.stack},foo:[],options:{cardClass:"publicity-card",gridClass:"publicity-arrangement"},internal_count:1,internal_offset:1,sponsored_count:1,sponsored_offset:1,init:function(){g.createComponents(),a.each(a(".publicity-card"),function(a,b){}),g.buildArrangement(c.getElementById("example_grid")),g.configureCards()},fetchCard:function(b,c,d,e,h,i){if(b)var j=b;else var j=a(".card:first");c||(c=parseInt(j.attr("data-offset"))),d||(d=parseInt(j.attr("data-count"))),e||(e=parseInt(j.attr("data-sp-offset"))),h||(h=parseInt(j.attr("data-sp-count"))),g.internal_count=c||1,g.internal_offset++,g.sponsored_count=h||1,g.sponsored_offset++;a.ajax({url:f.API.endpoint,type:"get",dataType:f.API.type,cache:!1,data:{api_key:f.API.api_key,pub_id:f.API.pub_id,widget_id:f.API.widget_id,type:f.API.type,domain:f.API.domain,sponsored_count:g.sponsored_count,sponsored_offset:g.sponsored_offset},beforeSend:function(){g.activateLoader(j)},success:function(a){return a.length>0&&(g.stack.push(a[0]),"object"==typeof i&&i.isMounted()&&i.setState({data:g.stack.shift(),internal_count:g.internal_count,internal_offset:g.internal_offset,sponsored_count:g.sponsored_count,sponsored_offset:g.sponsored_offset})),a.length>0?a:void 0},error:function(a){}})},advanceCounters:function(a,b,c,d){g.internal_count=a||1,g.internal_offset++,g.sponsored_count=d||1,g.sponsored_offset++},retrieveAds:function(b,c,d,e,h,i){a.ajax({url:f.API.endpoint,type:"get",dataType:f.API.type,cache:!1,data:{api_key:f.API.api_key,pub_id:f.API.pub_id,widget_id:f.API.widget_id,type:f.API.type,domain:f.API.domain,sponsored_count:b||g.sponsored_count,sponsored_offset:c||g.sponsored_offset},beforeSend:function(){},success:function(a){a.length>0&&(console.log("Successs!",a),g.stack.concat(a),console.log(typeof i,i),"function"==typeof i&&(g.advanceCounters(c,b,c,b),i(a,e,d,c,h)))},error:function(){}})},showDismissal:function(b){b.find(".dismissal").animate({"margin-top":0},700,"easeOutQuart",function(){a(this).addClass("on").removeClass("off")})},hideDismissal:function(b){b.find(".dismissal").animate({"margin-top":"-600px"},700,"easeInQuart",function(){a(this).removeClass("on").addClass("off")})},activateLoader:function(b){return b.find(".overlay").css({backgroundColor:"rgba(0,0,0,0.9)"}),b.find(".loader").transition({x:0,y:0,opacity:1},800,"easeOutQuad",function(){b.find(".overlay").animate({backgroundColor:"rgba(0,0,0,0.1)"},350,"easeInOutCirc",function(){}),a(this).addClass("activated").removeClass("deactivated")}),this},deactivateLoader:function(b){return a(b).find(".loader").transition({x:-700,y:-700,opacity:0},1e3,"easeOutQuad",function(){b.find(".overlay").animate({backgroundColor:"rgba(0,0,0,0.1)"},450,"easeInOutCirc",function(){})}),this},dockCard:function(b){return g.hideDismissal(b),b.animate({"margin-bottom":"-500px",opacity:0},600,"easeOutSine",function(){a(this).addClass("fixed").addClass("docked")}),setTimeout(function(){g.revealCard(b)},5e3),this},revealCard:function(b){return b.animate({"margin-bottom":0,opacity:1,left:a(".wrapper").offset().left},900,"easeOutExpo",function(){a(this).removeClass("docked")}),this},restoreCard:function(a){a.removeClass("fixed").removeClass("docked").animate({"margin-bottom":0,opacity:.5,left:0,opacity:1})},nextCard:function(a){},configureCards:function(){a.each(a(".card"),function(b,c){a(c).find(".dismissal").find(".close-dismissal").on("click",function(){g.hideDismissal(a(c))}),a(c).find(".dismissal").find(".remove-ad").on("click",function(){g.nextCard(a(c))}),a(c).find(".close-card").on("click",function(){g.showDismissal(a(c))}),a.each(a(c).find(".dismissal ul").children(),function(b,c){a(c).on("click",function(){a(this).addClass("selected").siblings().removeClass("selected")})})})},createComponents:function(){g.PosterArrangement=d.createClass({displayName:"PosterArrangement",componentDidUpdate:function(){g.configureCards(),a(this.getDOMNode()).find(".spinner").css({marginTop:0,opacity:1}).delay(2e3).animate({marginTop:"10px",opacity:0},450,"easeOutExpo",function(){}),a(this.getDOMNode()).find(".load-btn").removeClass("disabled").delay(1e3).animate({opacity:1},450,"easeInQuad",function(){})},componentWillUpdate:function(){a(this.getDOMNode()).find(".load-btn").addClass("disabled").animate({opacity:0},250,"easeOutQuad",function(){}),a(this.getDOMNode()).find(".spinner").css({marginTop:"10px",opacity:0}).show().animate({marginTop:0,opacity:1},650,"easeOutExpo",function(){})},loadMoreCards:function(){var b=this.props.data,c=this;a.ajax({url:f.API.endpoint,type:"get",dataType:f.API.type,cache:!1,data:{api_key:f.API.api_key,pub_id:f.API.pub_id,widget_id:f.API.widget_id,type:f.API.type,domain:f.API.domain,sponsored_count:this.props.loadCount||g.sponsored_count,sponsored_offset:parseInt(a(this.getDOMNode()).find(".card-zone:last").find(".card").attr("data-offset"))||0},beforeSend:function(){},success:function(a){c.setProps({data:b.concat(a)})}})},render:function(){var a=this.props.data.map(function(a,b){return d.createElement(g.PosterCard,{key:b,data:a,dataOrientation:"left",dataSize:"normal",dataOffset:b})});return d.createElement("div",{className:"card-arrangement",ref:"myArrangement","data-load-more":1==this.props.loadMore?!0:!1,"data-load-count":this.props.loadCount,"data-load-offset":this.props.loadOffset},a,d.createElement("div",{className:"cf"}),this.props.loadMore?d.createElement(g.ArrangementLoader,{onClick:this.loadMoreCards}):"")}}),g.ArrangementLoader=d.createClass({displayName:"ArrangementLoader",getInitialState:function(){return{load_more:!1}},LoadCards:function(a){this.setState({load_more:!0})},componentDidMount:function(){},componentDidUpdate:function(){1==this.state.load_more&&this.isMounted()&&(this.props.onClick(),this.setState({load_more:!1}),a(this.getDOMNode()).find(".spinner").hide())},render:function(){return d.createElement("div",{className:"load-more"},d.createElement("div",{className:"spinner left",style:{display:"none"}},"LOADING"),d.createElement("div",{id:"adPortal",className:"ad-portal"}),d.createElement("a",{className:"load-btn btn btn-small btn-pill right",style:{fontSize:"12px",margin:"18px 10px"},onClick:this.LoadCards},"LOAD MORE"),d.createElement("div",{className:"cf"}))}}),g.PosterCard=d.createClass({displayName:"PosterCard",render:function(){return d.createElement("div",{className:""!=(this.props.dataOrientation||this.state.orientation)?"card-zone "+this.props.dataOrientation:"card-zone"},d.createElement("div",{className:(""!=(this.props.dataOrientation||this.state.orientation)?"card "+this.props.dataOrientation:"card")+" "+(""!=this.props.dataSize?this.props.dataSize:"normal"),"data-count":this.state.internal_count,"data-offset":this.props.dataOffset||this.state.internal_offset,"data-sp-count":this.state.sponsored_count,"data-sp-offset":this.state.sponsored_offset},d.createElement("span",{className:"card-icon restore-card"},d.createElement("i",{className:"oi","data-glyph":"arrow-circle-top"})),d.createElement("span",{className:"card-icon snooze-card"},d.createElement("i",{className:"oi","data-glyph":"timer"})),d.createElement(g.PosterCard.Close,null),d.createElement(g.PosterCard.Loader,null),d.createElement(g.PosterCard.Dismissal,null),d.createElement(g.PosterCard.Action,{data:this.props.data})))},getInitialState:function(){var a={data:{},internal_count:1,internal_offset:0,sponsored_count:1,sponsored_offset:0,orientation:"left",size:"normal"};return a},componentDidMount:function(){g.deactivateLoader(a(this.getDOMNode()))},componentDidUpdate:function(){g.deactivateLoader(a(this.getDOMNode()))},refreshCard:function(b){g.fetchCard(a(this.getDOMNode()),null,null,null,null,b)}}),g.PosterCard.Loader=d.createClass({displayName:"Loader",render:function(){return d.createElement("div",{className:"loader"},d.createElement("div",{className:"loading"},d.createElement("h2",null,"think bigger ..."),d.createElement("span",null),d.createElement("span",null),d.createElement("span",null),d.createElement("span",null),d.createElement("span",null),d.createElement("span",null),d.createElement("span",null)))}}),g.PosterCard.Dismissal=d.createClass({displayName:"Dismissal",render:function(){return d.createElement("div",{className:"dismissal off"},d.createElement("strong",null,"PLEASE CHOOSE A REASON ..."),d.createElement("ul",null,d.createElement("li",{className:"selected"},"This ad is misleading"),d.createElement("li",null,"I am unable to view it"),d.createElement("li",null,"Another reason here"),d.createElement("li",null,"TV killed the Radio")),d.createElement("a",{className:"btn btn-small btn-danger btn-primary remove-ad"},"REMOVE"),d.createElement("a",{className:"btn btn-small btn-success btn-secondary close-dismissal"},"CANCEL"))}}),g.PosterCard.Action=d.createClass({displayName:"Action",render:function(){return d.createElement("a",{href:this.props.data.url||"#",className:"cta"},d.createElement("div",{className:"image"},d.createElement("img",{className:"image",src:this.props.data.image||"http://placehold.it/320x240"})),d.createElement("div",{className:"headline"},this.props.data.headline),d.createElement("div",{className:"overlay"}))}}),g.PosterCard.Close=d.createClass({displayName:"Close",render:function(){return d.createElement("span",{className:"card-icon close-card"},"Ã—")}})},buildCard:function(b){""!=b&&d.render(d.createElement(g.PosterCard,{pollInterval:15e3,dataOrientation:a(b).data("orientation")||"left",dataSize:a(b).data("size")||"normal"}),b)},buildArrangement:function(b){if(""!=b){var c=parseInt(a(b).data("rows")),d=parseInt(a(b).data("cols")),e="true"==a(b).data("load-more")||1==a(b).data("load-more")?!0:!1,f=c*d;g.retrieveAds(f,0,d,e,b,g.renderArrangement),console.log("Got These ads...",g.getStack())}},renderArrangement:function(a,b,c,e,f){console.log("Running render with stack...",a),console.log("NODE: ",f),console.log("offset!",e),d.render(d.createElement(g.PosterArrangement,{data:a,loadMore:b,loadCount:c,loadOffset:e}),f)}};g.init()}(jQuery,window,document,React);